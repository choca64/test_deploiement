<div class="collaborations-page">
  <!-- NAV BAR -->
  <nav class="collab__nav">
    <a routerLink="/landing-page" class="nav-home">
      <span>üè†</span> Accueil
    </a>
    <div class="nav-logo">COLLABORATIONS</div>
    <a routerLink="/talents" class="nav-talents">
      <span>üë•</span> Talents
    </a>
  </nav>

  <!-- HEADER -->
  <header class="collab__header">
    <div class="header-content">
      <h1>ü§ù Mes Collaborations</h1>
      <p>G√©rez vos demandes de mise en relation</p>
    </div>
    <div class="header-stats">
      <div class="stat-box stat-box--received">
        <span class="stat-number">{{ getReceivedPendingRequests().length }}</span>
        <span class="stat-label">Re√ßues</span>
      </div>
      <div class="stat-box stat-box--sent">
        <span class="stat-number">{{ getSentPendingRequests().length }}</span>
        <span class="stat-label">Envoy√©es</span>
      </div>
      <div class="stat-box stat-box--accepted">
        <span class="stat-number">{{ getAcceptedRequests().length }}</span>
        <span class="stat-label">Accept√©es</span>
      </div>
    </div>
  </header>

  <!-- EMPTY STATE -->
  @if (requests.length === 0) {
    <div class="empty-state">
      <div class="empty-icon">üì≠</div>
      <h2>Aucune demande</h2>
      <p>Vous n'avez pas encore re√ßu ou envoy√© de demande de collaboration.</p>
      <a routerLink="/talents" class="btn-explore">
        <span>üë•</span> Explorer les talents
      </a>
    </div>
  }

  <!-- REQUESTS LIST -->
  @if (requests.length > 0) {
    <div class="requests-container">
      
      <!-- RECEIVED PENDING REQUESTS (can accept/decline) -->
      @if (getReceivedPendingRequests().length > 0) {
        <section class="requests-section">
          <h2 class="section-title">
            <span class="section-icon">üì•</span>
            Demandes re√ßues ({{ getReceivedPendingRequests().length }})
          </h2>
          
          <div class="requests-grid">
            @for (request of getReceivedPendingRequests(); track request.id) {
              <article class="request-card request-card--pending">
                <div class="request-header">
                  <div class="request-avatar">{{ request.fromName.charAt(0).toUpperCase() }}</div>
                  <div class="request-info">
                    <h3>{{ request.fromName }}</h3>
                    <span class="request-email">{{ request.fromEmail }}</span>
                  </div>
                  <span class="request-type">{{ getProjectTypeLabel(request.projectType) }}</span>
                </div>
                
                <div class="request-target">
                  <span class="target-label">Pour :</span>
                  <span class="target-name">{{ request.toTalentName }}</span>
                </div>
                
                <p class="request-message">{{ request.message }}</p>
                
                @if (request.skills.length > 0) {
                  <div class="request-skills">
                    @for (skill of request.skills; track skill) {
                      <span class="skill-tag">{{ skill }}</span>
                    }
                  </div>
                }
                
                <div class="request-footer">
                  <span class="request-date">{{ formatDate(request.createdAt) }}</span>
                  <div class="request-actions">
                    <button class="btn-action btn-accept" (click)="acceptRequest(request.id)" title="Accepter">
                      ‚úÖ Accepter
                    </button>
                    <button class="btn-action btn-decline" (click)="declineRequest(request.id)" title="Refuser">
                      ‚ùå Refuser
                    </button>
                  </div>
                </div>
              </article>
            }
          </div>
        </section>
      }

      <!-- SENT PENDING REQUESTS (waiting for response) -->
      @if (getSentPendingRequests().length > 0) {
        <section class="requests-section">
          <h2 class="section-title section-title--sent">
            <span class="section-icon">üì§</span>
            Demandes envoy√©es ({{ getSentPendingRequests().length }})
          </h2>
          
          <div class="requests-grid">
            @for (request of getSentPendingRequests(); track request.id) {
              <article class="request-card request-card--sent">
                <div class="request-badge-sent">Envoy√©e par vous</div>
                <div class="request-header">
                  <div class="request-avatar request-avatar--sent">{{ request.toTalentName.charAt(0).toUpperCase() }}</div>
                  <div class="request-info">
                    <h3>√Ä : {{ request.toTalentName }}</h3>
                    <span class="request-email">{{ request.toTalentEmail || 'Email non renseign√©' }}</span>
                  </div>
                  <span class="request-type">{{ getProjectTypeLabel(request.projectType) }}</span>
                </div>
                
                <p class="request-message">{{ request.message }}</p>
                
                <div class="request-footer">
                  <span class="request-date">{{ formatDate(request.createdAt) }}</span>
                  <div class="request-actions">
                    <span class="request-status status--waiting">‚è≥ En attente de r√©ponse</span>
                    <button class="btn-action btn-delete" (click)="deleteRequest(request.id)" title="Annuler">
                      üóëÔ∏è Annuler
                    </button>
                  </div>
                </div>
              </article>
            }
          </div>
        </section>
      }

      <!-- ACCEPTED REQUESTS -->
      @if (getAcceptedRequests().length > 0) {
        <section class="requests-section">
          <h2 class="section-title">
            <span class="section-icon">‚úÖ</span>
            Accept√©es ({{ getAcceptedRequests().length }})
          </h2>
          
          <div class="requests-grid">
            @for (request of getAcceptedRequests(); track request.id) {
              <article class="request-card request-card--accepted">
                @if (isSentByMe(request)) {
                  <div class="request-badge-sent">Envoy√©e par vous</div>
                }
                <div class="request-header">
                  <div class="request-avatar request-avatar--accepted">
                    {{ (isSentByMe(request) ? request.toTalentName : request.fromName).charAt(0).toUpperCase() }}
                  </div>
                  <div class="request-info">
                    @if (isSentByMe(request)) {
                      <h3>{{ request.toTalentName }}</h3>
                      <span class="request-email">{{ request.toTalentEmail }}</span>
                    } @else {
                      <h3>{{ request.fromName }}</h3>
                      <span class="request-email">{{ request.fromEmail }}</span>
                    }
                  </div>
                  <span class="request-status status--accepted">{{ getStatusLabel(request.status) }}</span>
                </div>
                
                <p class="request-message">{{ request.message }}</p>
                
                <div class="request-footer">
                  <span class="request-date">{{ formatDate(request.createdAt) }}</span>
                  <div class="request-actions">
                    <button class="btn-action btn-email" (click)="openEmail(isSentByMe(request) ? request.toTalentEmail : request.fromEmail, request)" title="Contacter">
                      üìß Contacter
                    </button>
                    <button class="btn-action btn-delete" (click)="deleteRequest(request.id)" title="Supprimer">
                      üóëÔ∏è
                    </button>
                  </div>
                </div>
              </article>
            }
          </div>
        </section>
      }

      <!-- DECLINED REQUESTS -->
      @if (getDeclinedRequests().length > 0) {
        <section class="requests-section">
          <h2 class="section-title section-title--muted">
            <span class="section-icon">‚ùå</span>
            Refus√©es ({{ getDeclinedRequests().length }})
          </h2>
          
          <div class="requests-grid">
            @for (request of getDeclinedRequests(); track request.id) {
              <article class="request-card request-card--declined">
                @if (isSentByMe(request)) {
                  <div class="request-badge-sent">Envoy√©e par vous</div>
                }
                <div class="request-header">
                  <div class="request-avatar request-avatar--declined">{{ request.fromName.charAt(0).toUpperCase() }}</div>
                  <div class="request-info">
                    <h3>{{ request.fromName }}</h3>
                    <span class="request-email">{{ request.fromEmail }}</span>
                  </div>
                  <span class="request-status status--declined">{{ getStatusLabel(request.status) }}</span>
                </div>
                
                <p class="request-message">{{ request.message }}</p>
                
                <div class="request-footer">
                  <span class="request-date">{{ formatDate(request.createdAt) }}</span>
                  <div class="request-actions">
                    <button class="btn-action btn-delete" (click)="deleteRequest(request.id)" title="Supprimer">
                      üóëÔ∏è Supprimer
                    </button>
                  </div>
                </div>
              </article>
            }
          </div>
        </section>
      }

    </div>
  }
</div>
