<!-- MINI CARD -->
<div class="three-d-wrapper">
  <article class="card animated" #cardEl (click)="openModal()" 
           [style.background]="getCardTheme().bg"
           [style.--color1]="getCardTheme().color1"
           [style.--color2]="getCardTheme().color2">
    <div class="card__content">
      
      <!-- HEADER -->
      <header class="card__header">
        <div class="card__level-badge">
          <span class="level-label">Niveau</span>
          <span class="level-value">{{ getLevelNumber() }}</span>
        </div>
        
        <div class="card__identity">
          <h3 class="card__name">{{ talent.nom }}</h3>
          <p class="card__role-small">{{ talent.role }}</p>
        </div>
        
        <div class="card__xp">
          <span class="xp-label">XP</span>
          <span class="xp-value">{{ talent.xpActuel || getXP() }} ‚ö°</span>
        </div>
      </header>

      <!-- AVATAR SECTION -->
      <section class="card__avatar-section">
        <div class="card__stat-main" *ngIf="talent.stats">
          <span class="stat-name">{{ talent.stats.principale.nom }}</span>
          <div class="stat-bar-mini">
            <div class="stat-bar-mini__fill" [style.width.%]="talent.stats.principale.valeur"></div>
          </div>
        </div>

        <div class="card__verified" *ngIf="talent.verified">
          <span>‚úì</span>
          <span>VERIFIED</span>
        </div>

        <div class="card__avatar" [ngStyle]="avatarStyle()">
          {{ talent.nom.charAt(0).toUpperCase() }}
        </div>

        <div class="card__role-badge">
          <span class="category-tag">{{ talent.categorie || 'technique' }}</span>
          <span class="role-text">{{ talent.role }}</span>
        </div>
      </section>

      <!-- SKILLS -->
      <section class="card__skills">
        <div class="skill-row" *ngIf="talent.competences?.[0]">
          <div class="skill-energies">
            <span class="energy" [ngClass]="'energy--' + getEnergyType(0)"></span>
          </div>
          <span class="skill-name">{{ talent.competences[0] }}</span>
          <span class="skill-damage">+{{ getSkillDamage(0) }}</span>
        </div>

        <div class="skill-row" *ngIf="talent.competences?.[1]">
          <div class="skill-energies">
            <span class="energy" [ngClass]="'energy--' + getEnergyType(1)"></span>
            <span class="energy energy--rainbow"></span>
          </div>
          <span class="skill-name">{{ talent.competences[1] }}</span>
          <span class="skill-damage">+{{ getSkillDamage(1) }}</span>
        </div>

        <div class="skill-row skill-row--special" *ngIf="talent.passions?.[0]">
          <div class="skill-energies">
            <span class="energy energy--rainbow"></span>
            <span class="energy energy--rainbow"></span>
            <span class="energy energy--rainbow"></span>
          </div>
          <span class="skill-name">
            {{ talent.passions[0] }}
            <span class="gx-tag">GX</span>
          </span>
          <span class="skill-damage">{{ getImpactDamage() }}</span>
        </div>

        <p class="skill-quote">"{{ talent.style.citation || 'Un talent unique' }}"</p>
      </section>

      <!-- FOOTER -->
      <footer class="card__footer">
        <div class="footer-stat">
          <span class="footer-stat__label">Risque</span>
          <span class="footer-stat__value footer-stat__value--risk">{{ talent.limites.risqueEchec || 10 }}%</span>
        </div>

        <div class="footer-stat">
          <span class="footer-stat__label">Langues</span>
          <div class="footer-langs">
            <span class="lang-tag" *ngFor="let lang of talent.langues?.slice(0, 3)">{{ lang }}</span>
          </div>
        </div>

        <div class="footer-stat">
          <span class="footer-stat__label">Projets</span>
          <span class="footer-stat__value">{{ talent.projets?.length || 0 }}</span>
        </div>
      </footer>

      <!-- CLICK HINT -->
      <div class="card__click-hint">
        <span>Cliquer pour voir plus</span>
      </div>

    </div>
  </article>
</div>

<!-- MODAL DETAIL VIEW -->
<div class="modal-overlay" *ngIf="isModalOpen" (click)="onOverlayClick($event)">
  <div class="modal-content">
    
    <!-- Close Button -->
    <button class="modal-close" (click)="closeModal()">‚úï</button>

    <!-- HORIZONTAL CARD LAYOUT -->
    <div class="detail-card">
      
      <!-- LEFT: Avatar & Identity -->
      <div class="detail-left">
        <div class="detail-avatar-zone">
          <div class="detail-avatar" [ngStyle]="avatarStyle()">
            {{ talent.nom.charAt(0).toUpperCase() }}
          </div>
          <div class="detail-verified" *ngIf="talent.verified">
            <span>‚úì</span> VERIFIED
          </div>
        </div>
        
        <div class="detail-identity">
          <div class="detail-level">
            <span class="detail-level__label">Niveau</span>
            <span class="detail-level__value">{{ getLevelNumber() }}</span>
          </div>
          <h2 class="detail-name">{{ talent.nom }}</h2>
          <p class="detail-role">{{ getCategoryIcon() }} {{ talent.role }}</p>
          <div class="detail-xp">
            <span class="detail-xp__value">{{ talent.xpActuel || getXP() }}</span>
            <span class="detail-xp__label">XP ‚ö°</span>
          </div>
        </div>

        <div class="detail-meta">
          <span *ngIf="talent.ville">üìç {{ talent.ville }}</span>
          <span *ngIf="talent.promo">üéì {{ talent.promo }}</span>
          <span *ngIf="talent.email">‚úâÔ∏è {{ talent.email }}</span>
        </div>
      </div>

      <!-- CENTER: Stats & Skills -->
      <div class="detail-center">
        <div class="detail-section">
          <h3 class="detail-section__title">üìä Statistiques</h3>
          <div class="detail-stats">
            <div class="detail-stat" *ngIf="talent.stats">
              <span class="detail-stat__name">{{ talent.stats.principale.nom }}</span>
              <div class="detail-stat__bar">
                <div class="detail-stat__fill" [style.width.%]="talent.stats.principale.valeur"></div>
              </div>
              <span class="detail-stat__value">{{ talent.stats.principale.valeur }}%</span>
            </div>
            <div class="detail-stat" *ngFor="let stat of talent.stats?.secondaires">
              <span class="detail-stat__name">{{ stat.nom }}</span>
              <div class="detail-stat__bar">
                <div class="detail-stat__fill" [style.width.%]="stat.valeur"></div>
              </div>
              <span class="detail-stat__value">{{ stat.valeur }}%</span>
            </div>
          </div>
        </div>

        <div class="detail-section">
          <h3 class="detail-section__title">‚ö° Comp√©tences</h3>
          <div class="detail-skills">
            <span class="detail-skill" *ngFor="let skill of getAllSkills(); let i = index">
              <span class="energy-dot" [ngClass]="'energy--' + getEnergyType(i)"></span>
              {{ skill }}
              <span class="skill-pts">+{{ getSkillDamage(i) }}</span>
            </span>
          </div>
        </div>

        <div class="detail-section" *ngIf="talent.passions?.length">
          <h3 class="detail-section__title">‚ù§Ô∏è Passions</h3>
          <div class="detail-passions">
            <span class="detail-passion" *ngFor="let passion of talent.passions">{{ passion }}</span>
          </div>
        </div>
      </div>

      <!-- RIGHT: Extra Info -->
      <div class="detail-right">
        <div class="detail-section" *ngIf="getStrengths().length">
          <h3 class="detail-section__title">üí™ Forces</h3>
          <ul class="detail-list">
            <li *ngFor="let force of getStrengths()">{{ force }}</li>
          </ul>
        </div>

        <div class="detail-section" *ngIf="talent.langues?.length">
          <h3 class="detail-section__title">üåç Langues</h3>
          <div class="detail-langs">
            <span class="detail-lang" *ngFor="let lang of talent.langues">{{ lang }}</span>
          </div>
        </div>

        <div class="detail-section" *ngIf="talent.projets?.length">
          <h3 class="detail-section__title">üöÄ Projets</h3>
          <ul class="detail-list detail-list--projects">
            <li *ngFor="let projet of talent.projets">{{ projet }}</li>
          </ul>
        </div>

        <div class="detail-section" *ngIf="talent.tags?.length">
          <h3 class="detail-section__title">üè∑Ô∏è Tags</h3>
          <div class="detail-tags">
            <span class="detail-tag" *ngFor="let tag of talent.tags">{{ tag }}</span>
          </div>
        </div>

        <div class="detail-quote" *ngIf="talent.style?.citation">
          <span class="quote-icon">"</span>
          <p>{{ talent.style.citation }}</p>
        </div>

        <!-- CONTACT BUTTON -->
        <button class="detail-contact-btn" (click)="openContactModal($event)">
          <span>ü§ù</span> Contacter {{ talent.nom.split(' ')[0] }}
        </button>
      </div>

    </div>
  </div>
</div>

<!-- CONTACT MODAL -->
<div class="contact-modal-overlay" *ngIf="isContactModalOpen" (click)="onOverlayClick($event)">
  <div class="contact-modal">
    <button class="contact-modal__close" (click)="closeContactModal()">‚úï</button>
    
    <!-- Success State -->
    <div class="contact-success" *ngIf="contactSent">
      <div class="success-icon">‚úÖ</div>
      <h3>Message envoy√© !</h3>
      <p>Votre demande de collaboration a √©t√© envoy√©e √† {{ talent.nom }}.</p>
    </div>

    <!-- Form State -->
    <div class="contact-form" *ngIf="!contactSent">
      <div class="contact-header">
        <div class="contact-avatar" [ngStyle]="avatarStyle()">
          {{ talent.nom.charAt(0).toUpperCase() }}
        </div>
        <div class="contact-info">
          <h3>Contacter {{ talent.nom }}</h3>
          <p>{{ talent.role }}</p>
        </div>
      </div>

      <form (ngSubmit)="sendContactRequest()">
        <div class="form-row">
          <div class="form-field">
            <label>Votre nom <span class="required">*</span></label>
            <input 
              type="text" 
              [(ngModel)]="contactForm.fromName" 
              name="fromName"
              placeholder="Votre nom complet"
              required>
          </div>
          <div class="form-field">
            <label>Votre email <span class="required">*</span></label>
            <input 
              type="email" 
              [(ngModel)]="contactForm.fromEmail" 
              name="fromEmail"
              placeholder="votre@email.com"
              required>
          </div>
        </div>

        <div class="form-field">
          <label>Type de demande</label>
          <select [(ngModel)]="contactForm.projectType" name="projectType">
            <option *ngFor="let type of projectTypes" [value]="type.value">
              {{ type.label }}
            </option>
          </select>
        </div>

        <div class="form-field">
          <label>Comp√©tences recherch√©es (optionnel)</label>
          <input 
            type="text" 
            [(ngModel)]="contactForm.skills" 
            name="skills"
            placeholder="Ex: Angular, UX Design, Node.js">
          <span class="form-hint">S√©par√©es par des virgules</span>
        </div>

        <div class="form-field">
          <label>Votre message <span class="required">*</span></label>
          <textarea 
            [(ngModel)]="contactForm.message" 
            name="message"
            rows="4"
            placeholder="Pr√©sentez votre projet ou votre demande..."
            required></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeContactModal()">Annuler</button>
          <button type="submit" class="btn-send" [disabled]="!contactForm.fromName || !contactForm.fromEmail || !contactForm.message">
            üì© Envoyer la demande
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
